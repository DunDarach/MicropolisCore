var f=Object.defineProperty;var w=(o,i,t)=>i in o?f(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var n=(o,i,t)=>(w(o,typeof i!="symbol"?i+"":i,t),t);import{i as M,h as H,j as z,f as v,g as x,$ as _,b as E,m as I,e as T,k as X,a as Y}from"../chunks/disclose-version.CafPAp_i.js";import{p as b,a as D,g as u,s as y}from"../chunks/runtime.CdZnOCbx.js";import{o as C}from"../chunks/main-client.IJzbkb9O.js";const P=!0,B=Object.freeze(Object.defineProperty({__proto__:null,prerender:P},Symbol.toStringTag,{value:"Module"})),R=""+new URL("../assets/tiles.CXP0i5T3.png",import.meta.url).href;class j{constructor(){n(this,"context");n(this,"mapData");n(this,"mapWidth",0);n(this,"mapHeight",0);n(this,"tileWidth",0);n(this,"tileHeight",0);n(this,"panX",0);n(this,"panY",0);n(this,"viewWidth",0);n(this,"viewHeight",0);n(this,"zoom",1);this.context=void 0,this.mapData=[],this.mapWidth=0,this.mapHeight=0,this.tileWidth=0,this.tileHeight=0,this.viewWidth=0,this.viewHeight=0}initialize(i,t,e,l,r,s,a){return this.context=i,this.mapData=t,this.mapWidth=e,this.mapHeight=l,this.tileWidth=r,this.tileHeight=s,Promise.resolve()}handleDrag(i,t){this.panX+=i,this.panY+=t}handleZoom(i,t,e){this.zoom*=i,this.panX=(this.panX-t)*i+t,this.panY=(this.panY-e)*i+e}updateScreenSize(i){this.viewWidth=i.width,this.viewHeight=i.height}}class O extends j{constructor(){super();n(this,"tileImage",null)}initialize(t,e,l,r,s,a,c){return super.initialize(t,e,l,r,s,a,c).then(()=>(this.context=t,this.tileImage=new Image,this.tileImage.src=c,new Promise((m,p)=>{if(!this.context||!this.tileImage)throw new Error("Canvas context or tile image is not properly initialized.");this.tileImage.onload=()=>m(),this.tileImage.onerror=()=>p(new Error(`Failed to load image at ${c}`))})))}render(){if(!this.context||!this.tileImage)throw new Error("Canvas context or tile image is not properly initialized.");this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);const t=Math.max(0,Math.floor(this.panX/this.zoom)),e=Math.max(0,Math.floor(this.panY/this.zoom)),l=Math.min(this.mapWidth,Math.ceil((this.panX+this.viewWidth/this.zoom)/this.tileWidth)),r=Math.min(this.mapHeight,Math.ceil((this.panY+this.viewHeight/this.zoom)/this.tileHeight));for(let s=e;s<r;s++)for(let a=t;a<l;a++){const c=this.mapData[s*this.mapWidth+a],m=(a*this.tileWidth-this.panX)*this.zoom,p=(s*this.tileHeight-this.panY)*this.zoom,g=c%(this.tileImage.width/this.tileWidth)*this.tileWidth,d=Math.floor(c/(this.tileImage.width/this.tileWidth))*this.tileHeight;this.context.drawImage(this.tileImage,g,d,this.tileWidth,this.tileHeight,m,p,this.tileWidth*this.zoom,this.tileHeight*this.zoom)}}}var S=E('<meta name="description" content="Micropolis Home">'),k=X(`<section class="svelte-19xx0bt"><script>
	<\/script> <canvas width="512" height="512"></canvas></section>`);function G(o,i){D(i,!1);let t=I(null),e=null;const l=256,r=256,s=16,a=16,c=R,m=Array.from({length:l*r},()=>Math.floor(Math.random()*256));C(()=>{if(console.log("TileEngine Test: onMount:","canvas:",u(t)),u(t)==null){console.log("TileEngine Test: onMount: canvas is null!");return}const h=u(t).getContext("2d");if(console.log("TileEngine Test: onMount:","context:",h),h==null){console.log("TileEngine Test: onMount: no 2d canvas context!");return}if(e=new O,console.log("TileEngine Test: onMount: renderer:",e),e==null){console.log("TileEngine Test: onMount: no CanvasTileRenderer!");return}console.log("TileEngine Test: onMount: initialize:","context:",h,"mapData:",m,"mapWidth:",l,"mapHeight:",r,"tileWidth:",s,"tileWidth:",a,"tileTexture:",c),e.initialize(h,m,l,r,s,a,c).then(()=>{if(console.log("TileEngine Test: onMount: initialize: then:","context:",h,"renderer:",e),e==null){console.log("no renderer!");return}e.render()})}),M();var p=x(o,!0,k);H(h=>{var W=x(h,!0,S);_.title="Micropolis Home",v(h,W)});var g=Y(p),d=T(T(g,!0));z(d,h=>y(t,h),t),v(o,p),b()}export{G as component,B as universal};
