var _=Object.defineProperty;var S=(a,e,t)=>e in a?_(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e,t)=>(S(a,typeof e!="symbol"?e+"":e,t),t);import{i as R,l as D,f as M,m as y,g as H,a as X,e as p,b as z,h as L,$ as P}from"../chunks/disclose-version.DoYd6o5v.js";import{p as Y,a as b,g,s as V}from"../chunks/runtime.CdZnOCbx.js";import{o as E}from"../chunks/main-client.FKcJxd4c.js";const G=!0,U=Object.freeze(Object.defineProperty({__proto__:null,prerender:G},Symbol.toStringTag,{value:"Module"})),j=""+new URL("../assets/tiles.CXP0i5T3.png",import.meta.url).href;class O{constructor(){o(this,"context");o(this,"mapData");o(this,"mapWidth",0);o(this,"mapHeight",0);o(this,"tileWidth",0);o(this,"tileHeight",0);o(this,"panX",0);o(this,"panY",0);o(this,"viewWidth",0);o(this,"viewHeight",0);o(this,"zoom",1);this.context=void 0,this.mapData=[],this.mapWidth=0,this.mapHeight=0,this.tileWidth=0,this.tileHeight=0,this.viewWidth=0,this.viewHeight=0}initialize(e,t,n,h,l,r,m){return this.context=e,this.mapData=t,this.mapWidth=n,this.mapHeight=h,this.tileWidth=l,this.tileHeight=r,Promise.resolve()}handleDrag(e,t){this.panX+=e,this.panY+=t}handleZoom(e,t,n){this.zoom*=e,this.panX=(this.panX-t)*e+t,this.panY=(this.panY-n)*e+n}updateScreenSize(e,t){this.viewWidth=e,this.viewHeight=t}}class A extends O{constructor(){super();o(this,"tileImage",null)}initialize(t,n,h,l,r,m,u){return super.initialize(t,n,h,l,r,m,u).then(()=>(this.context=t,this.tileImage=new Image,this.tileImage.src=u,new Promise((v,c)=>{if(!this.context||!this.tileImage)throw new Error("Canvas context or tile image is not properly initialized.");this.tileImage.onload=()=>v(),this.tileImage.onerror=()=>c(new Error(`Failed to load image at ${u}`))})))}render(){if(!this.context||!this.tileImage)throw new Error("Canvas context or tile image is not properly initialized.");this.context.fillStyle="#000000",this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height);const t=this.context.canvas.width,n=this.context.canvas.height,h=t/2,l=n/2;this.tileWidth*this.zoom,this.tileHeight*this.zoom;const r=Math.max(0,Math.floor(this.panX/this.zoom)),m=Math.max(0,Math.floor(this.panY/this.zoom)),u=this.mapWidth,v=this.mapHeight;for(let c=m;c<v;c++)for(let i=r;i<u;i++){const d=this.mapData[c*this.mapWidth+i],s=h+(i-this.panX)*this.tileWidth*this.zoom,f=l+(c-this.panY)*this.tileHeight*this.zoom,w=this.tileImage.width/this.tileWidth,x=d%w*this.tileWidth,T=Math.floor(d/w)*this.tileHeight;this.context.drawImage(this.tileImage,x,T,this.tileWidth,this.tileHeight,s,f,this.tileWidth*this.zoom,this.tileHeight*this.zoom)}}}var Z=z('<div><canvas width="512" height="512" class="svelte-mnct6x"></canvas> <br> <canvas width="512" height="512" class="svelte-mnct6x"></canvas></div>');function k(a,e){b(e,!1);let t=256,n=256,h=t*n,l=16,r=16,m=960,u=256,v=960,c=j,i=y(null),d=null,s=null,f=null;const w=Array.from({length:h},()=>Math.floor(Math.random()*256));E(()=>{if(console.log("TileView: onMount: ","mapData:",w,"mapWidth:",t,"mapHeight:",n,"mapLength:",h,"tileWidth:",l,"tileWidth:",r,"tileCount:",m,"tileTexture:",c,"tileTextureWidth:",u,"tileTextureHeight:",v,"tileTexture:",c),console.log("TileView: onMount:","canvas2D:",g(i)),g(i)==null){console.log("TileView: onMount: canvas2D is null!");return}if(d=g(i).getContext("2d"),console.log("TileView: onMount:","ctx2D:",d),d==null){console.log("TileView: onMount: no ctx!");return}if(s=new A,console.log("TileView: onMount: canvasTileRenderer:",s),s==null){console.log("TileView: onMount: no canvasTileRenderer!");return}console.log("TileView: onMount: initialize:","canvas2D:",g(i),"ctx2D:",d,"canvasTileRenderer:",s),s.initialize(d,w,t,n,l,r,c).then(()=>{if(console.log("TileView: onMount: initialize: then:","canvas2D:",g(i),"ctx2D:",d,"canvasTileRenderer:",s),g(i)==null){console.log("TileView: onMount: initialize: then: no canvas2D!");return}if(d==null){console.log("TileView: onMount: initialize: then: no ctx2D!");return}if(s==null){console.log("TileView: onMount: initialize: then: no canvasTileRenderer!");return}s.updateScreenSize(g(i).width,g(i).height),s.panX=t/2,s.panY=n/2,s.render()}),console.log("TileView: onMount:","canvasGL:",f);{console.log("TileView: onMount: canvasGL is null!");return}}),R();var x=H(a,!0,Z),T=X(x);D(T,W=>V(i,W),i);var C=p(p(T,!0)),I=p(p(C,!0));D(I,W=>V(i,W),i),M(a,x),Y()}var q=z('<meta name="description" content="Micropolis Home">'),B=z('<section class="svelte-5p4ri1"><h1 class="svelte-5p4ri1">Canvas and WebGL Tile View Test:</h1> <!></section>');function $(a,e){b(e,!1),R();var t=H(a,!0,B);L(l=>{var r=H(l,!0,q);P.title="Micropolis Home",M(l,r)});var n=X(t),h=p(p(n,!0));k(h,{}),M(a,t),Y()}export{$ as component,U as universal};
